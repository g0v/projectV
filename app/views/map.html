<!--
<button type="button" class="btn btn-primary" ng-click="myscope.reload()">
  <i class="fa fa-chevron-left"></i>reload 
</button>
-->
<style>
.map_border , .map_border_noleft{
  border: 5px solid #C2003F; 
}

.map_border_noleft {
  border-left: 0px; 
}
.map_border_top{
  border-top: 5px solid #C2003F; 
}

.map_hr{
  border: 3px solid #C2003F; 
  border-top: 0px; 
  width:100%;
}

.map_panel_heading{
  /*background: #C2003F;
  color: #ffffff;  */
}

.map_panel_heading h3{
  background-image: url('images/map_panel_header.png');
  background-size: 100% 100%;
  padding:5px;
  width:90%;
  color: #ffffff;
}

.map_vs_image{
  height:100px;
  width:88px;
  position:absolute;
  top:230px;
  left:50%;
  margin-left:-44px;
  z-index:10;
}
.map_v_image{
  position:absolute;
  top:160px;
  left:50%;
  margin-left:-32px;
  z-index:10;
}


.map_fb_image{
  margin:2px;width:40px;
  border:3px solid  #C2003F;
}

.map_button{
  background:none;
  border:0px;
  background-image: url('images/map_button.svg');
  background-size: 100% 100%;
  font-size:120%;
  color:#C2003F;
  padding:10px;
  padding-left:40px;
  padding-right:40px;
}



.imgWrap {
  position: relative;
  display:inline-block;
}


.imgDescription {
  padding:5px;
  width:80px;
  position: absolute;
  top: -80px;
  height:70px;
  bottom: 0;
  left: 0;
  right: 0;
  background: #ffffff;
  color:#C2003F;
  border: 3px solid #C2003F;
  opacity: 0;
}
.imgArrow {
  position: absolute;
  top: -10px;
  left:10px;
  width: 0; 
  height: 0; 
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-top: 10px solid #C2003F;
  opacity: 0;
}

.imgDescription, .imgArrow{
  visibility: hidden;
}

.imgWrap:hover .imgDescription , .imgWrap:hover .imgArrow{
  visibility: visible;
  opacity: 1;
}
.imgWrap img{
  margin:2px;
  cursor:pointer;
}


</style>
<div class="row mymap" style="margin-bottom:10px;">
  <div class="col-md-9 map_border" style="padding:0px;height:800px;">
    <leaflet markers="markers" defaults="defaults" geojson="geojson" style="height:100%;"></leaflet>
    <div style="width: 100%; height: 100%; background: #333333; z-index: 200000; position: absolute; top: 0px; " class="myLoading">
      <div style="position:relative; color:#ffffff; top:60%;text-align:center;">
        <h1>{{myscope.mapLoadingStatus |  percentage:0 }}</h1>
      </div>
      <div id="mySpinner" >
      </div>
    </div>
  </div>
  <div class="col-md-3 map_border_noleft" style="padding:0px;height:800px;" >
    <div style="width: 100%; height: 100%; background: #333333; z-index: 200000; position: absolute; top: 0px; " class="myLoading">
    </div>
    <div class="panel panel-default area-info" style="width:100%;padding:0px;margin:0px;border:0px;" ng-show="myscope.showVS == null && myscope.mapLoadingStatus >= 1" >
      <div class="map_panel_heading" style="height:60px;">
        <h3>
          魔王領土兵屯列表
        </h3>
        <img class="map_v_image" src="images/map_panel_v.svg" />
      </div>
      <div class="panel-body map_border_top" style="overflow-x:hidden; overflow-y:scroll; position:relative;height:120px;">
        <ul class="nav nav-stacked" ng-repeat="(townKey,townVal) in myscope.villageSum" >
          <li ng-click='myscope.setTownTab(townKey)' style="cursor:pointer;" ng-class="myscope.isCurrentTownTab(townKey)">{{townKey}}</li>
        </ul>
      </div>
      <div class="panel-body map_border_top" style="overflow-x:hidden; overflow-y:scroll; height:580px;">
        <div style="height:50px">
        </div>
        <div ng-repeat="(townKey,townVal) in myscope.villageSum" ng-show="myscope.currentTownTab == townKey">
          <div ng-repeat="(villKey,villVal) in townVal">
            <div class="row">
              <div class="col-md-7 col-lg-8">
                <div class="progress ">
                  <div class="progress-bar " role="progressbar" aria-valuenow="{{villVal*100}}" 
                    aria-valuemin="0" aria-valuemax="100" style="width: {{villVal*100}}%;">
                    {{villVal |  percentage:0}}
                  </div>
                </div>
              </div>
              <div class="col-md-5 col-lg-4">
                <a href="javascript:void(0);" ng-click="myscope.setCurrentAreaClick(townKey,villKey)"> {{villKey}}</a>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>



    <div class="panel panel-default area-info" style="width:100%;padding:0px;margin:0px;border:0px;" ng-show="myscope.showVS != null && myscope.mapLoadingStatus >= 1" >
      <div class="map_panel_heading" style="height:60px;">
        <h3>
          兵屯詳細概況
        </h3>
        <img class="map_vs_image" src="images/map_panel_vs_1.svg" ng-show=" myscope.getVoteStatImg() == 1"/>
        <img class="map_vs_image" src="images/map_panel_vs_2.svg" ng-show=" myscope.getVoteStatImg() == 2"/>
        <img class="map_vs_image" src="images/map_panel_vs_3.svg" ng-show=" myscope.getVoteStatImg() == 3"/>
      </div>
      <div class="panel-body map_border_top" style="overflow-x:hidden; overflow-y:scroll; height:200px;">
        <div class="back-button" style="" ng-show="myscope.showVS != null">
          <button type="button" class="btn btn-primary" ng-click="myscope.back()">
            Back
          </button>
          {{myscope.showVS.townName}} {{myscope.showVS.villageName}} 
        </div>

        <div style="height:30px;"></div>

        <ul class="nav nav-stacked" ng-repeat="votestat in myscope.showVS.vsArray" >
          <li ng-click='myscope.setCurrentMarkerClick(votestat.id)' style="cursor:pointer;" ng-class="myscope.isCurrentVsTab(votestat.id)">{{votestat.name}}</li>
        </ul>
      </div>

      <div class="panel-body map_border_top" style="overflow-x:hidden; overflow-y:scroll; height:500px;">
        <div style="height:30px">
        </div>
        <div>
          <div style="padding:10px;">
            <h5>志工數：{{myscope.vsInfo[myscope.currentVsTab.vsId].vlist.length}} /
              {{myscope.volCount * myscope.vsInfo[myscope.currentVsTab.vsId].vweight}}
            </h5> 
            <div class="progress">
              <div class="progress-bar" role="progressbar" aria-valuenow="{{myscope.vsInfo[myscope.currentVsTab.vsId].volunteer * 100}}" 
                aria-valuemin="0" aria-valuemax="100" style="width: {{myscope.vsInfo[myscope.currentVsTab.vsId].volunteer * 100}}%;">
              </div>
            </div>

            <button type="button" class="map_button" ng-click="myscope.registerDialog('volunteer')">
              志工參戰 
            </button>

            <div id="hp_people" style="margin:5px" >
              <div class="imgWrap" ng-repeat="name in myscope.vsInfo[myscope.currentVsTab.vsId].vlist track by $index">
                <div class="imgArrow"></div>
                <div class="imgDescription" style="overflow:hidden;">
                  {{name[1]}}
                </div>
                <img class="img-circle map_fb_image" src="http://graph.facebook.com/{{name[0]}}/picture?type=small">
              </div>
            </div>
          </div>
          
          <hr class="map_hr">     
      
          <div style="padding:10px;padding-top:0px;">
            <h5>物資數：{{myscope.vsInfo[myscope.currentVsTab.vsId].sItemSum}} / 
              {{myscope.vsInfo[myscope.currentVsTab.vsId].sTotalSum}}
            </h5> 
            <div class="progress">
              <div class="progress-bar" role="progressbar" aria-valuenow="{{myscope.vsInfo[myscope.currentVsTab.vsId].supplement*100}}" 
                aria-valuemin="0" aria-valuemax="100" style="width: {{myscope.vsInfo[myscope.currentVsTab.vsId].supplement*100}}%;">
              </div>
            </div>


            <div id="supply" style="margin:5px" >
              <!--<span style="margin:2px" ng-repeat="(item,tcount) in myscope.vsInfo[myscope.currentVsTab.vsId].sItemTotal">
                <img src="images/supply_{{ myscope.vsInfo[myscope.currentVsTab.vsId].sItemCount[item] >= tcount && 'r'  || 'g' }}_{{item}}.svg" style="width:40px;">
              </span>-->

              <div class="imgWrap" ng-repeat="(item,count) in myscope.vsInfo[myscope.currentVsTab.vsId].sItemCount">
                <div class="imgArrow"></div>
                <div class="imgDescription">
                  <p> {{myscope.supplementItem[item][1]}} </p>
                  <p>{{myscope.vsInfo[myscope.currentVsTab.vsId].sItemCount[item]}} / 
                    {{myscope.supplementItem[item][0] * myscope.vsInfo[myscope.currentVsTab.vsId].vweight}}
                  </p>
                </div>
                <img src="images/supply_{{ count >= myscope.supplementItem[item][0] * myscope.vsInfo[myscope.currentVsTab.vsId].vweight
                   && 'r'  || 'g' }}_{{item}}.svg" style="width:40px;">
              </div>

            </div>

            <button type="button" class="map_button" ng-click="myscope.registerDialog('supplement')">
              物資參戰  
            </button>

            <div id="sp_people" style="margin:5px" >
              <div class="imgWrap" ng-repeat="name in myscope.vsInfo[myscope.currentVsTab.vsId].slist track by $index">
                <div class="imgArrow"></div>
                <div class="imgDescription" style="overflow:hidden;">
                  {{name[1]}}
                </div>
                <img class="img-circle map_fb_image" src="http://graph.facebook.com/{{name[0]}}/picture?type=small">
              </div>

            </div>
          </div>
        </div>

      </div>
    </div>

  </div>

</div>
<script>
var opts = {
  lines: 13, // The number of lines to draw
  length: 21, // The length of each line
  width: 10, // The line thickness
  radius: 30, // The radius of the inner circle
  corners: 1, // Corner roundness (0..1)
  rotate: 0, // The rotation offset
  direction: 1, // 1: clockwise, -1: counterclockwise
  color: '#ffffff', // #rgb or #rrggbb or array of colors
  speed: 1, // Rounds per second
  trail: 60, // Afterglow percentage
  shadow: true, // Whether to render a shadow
  hwaccel: false, // Whether to use hardware acceleration
  className: 'spinner', // The CSS class to assign to the spinner
  zIndex: 2e9, // The z-index (defaults to 2000000000)
  top: '50%', // Top position relative to parent
  left: '50%' // Left position relative to parent
};
var target = document.getElementById('mySpinner');
var spinner = new Spinner(opts).spin(target);
</script>
